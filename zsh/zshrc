# Lines configured by zsh-newuser-install
HISTFILE=~/.histfile
HISTSIZE=1000
SAVEHIST=1000
bindkey -v

# The lines added by compinstall
zstyle :compinstall filename "${HOME}/.zshrc"

autoload -Uz compinit
compinit

# Lines for antigen setup
if [[ $(uname -s) == "Darwin" ]]
then
    source $(brew --prefix)/share/antigen/antigen.zsh
else
    source /usr/share/zsh/share/antigen.zsh
fi

# Load the oh-my-zsh's library.
antigen use oh-my-zsh

# Bundles from the default repo (robbyrussell's oh-my-zsh).
antigen bundle git
antigen bundle heroku
antigen bundle pip
antigen bundle lein
antigen bundle command-not-found

# Syntax highlighting bundle.
antigen bundle zsh-users/zsh-syntax-highlighting

# Load the theme.
antigen theme robbyrussell

# Tell Antigen that you're done.
antigen apply

# Set GPG TTY
if [[ $(uname -s) == "Linux" ]]
then
    if grep -c "arch" /etc/os-release > /dev/null 2>&1; then
        # Start the gpg-agent if not already running
        if ! pgrep -x -u "${USER}" gpg-agent >/dev/null 2>&1; then
            gpg-connect-agent /bye >/dev/null 2>&1
        fi

        # Set SSH to use gpg-agent
        unset SSH_AGENT_PID
        if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
            export SSH_AUTH_SOCK="/run/user/$UID/gnupg/S.gpg-agent.ssh"
        fi
    fi

    if grep -c "ubuntu" /etc/os-release > /dev/null 2>&1; then
        # Start the gpg-agent if not already running
        if ! pgrep -x -u "${USER}" gpg-agent >/dev/null 2>&1; then
            gpg-agent --daemon --enable-ssh-support
        fi

        # Set SSH to use gpg-agent
        unset SSH_AGENT_PID
        if [ "${gnupg_SSH_AUTH_SOCK_by:-0}" -ne $$ ]; then
            export SSH_AUTH_SOCK="$HOME/.gnupg/S.gpg-agent.ssh"
        fi
    fi

    export GPG_TTY=$(tty)
    # Refresh gpg-agent tty in case user switches into an X session
    gpg-connect-agent updatestartuptty /bye >/dev/null
fi
